# π” μ ν’ μ•μ „μ„± κ²€μ‚¬ λ΅μ§ (Product Safety Check Logic)

μ΄ λ¬Έμ„λ” `TEST1` ν΄λ”μ—μ„ ν…μ¤νΈν•κ³ , λ°±μ—”λ“(`/api/search`)μ— μ μ©λ **μ ν’ μ•λ¬μ§€ λ° μ§€λ³‘ μ£Όμ μ •λ³΄ ν‘μ‹ κΈ°λ¥**μ μ‘λ™ μ›λ¦¬λ¥Ό μ„¤λ…ν•©λ‹λ‹¤.

---

## 1. κ°μ” (Overview)

μ‚¬μ©μκ°€ μ ν’μ„ κ²€μƒ‰ν•  λ•, λ‹¨μν μ ν’ μ •λ³΄λ§ λ³΄μ—¬μ£Όλ” κ²ƒμ΄ μ•„λ‹λΌ **λ΅κ·ΈμΈν• μ μ €μ κ±΄κ°• μ •λ³΄(μ•λ¬μ§€, μ§€λ³‘)**λ¥Ό κΈ°λ°μΌλ΅ μ„­μ·¨ μ‹ μ£Όμν•΄μ•Ό ν•  μ‚¬ν•­μ„ **μλ™μΌλ΅ λ¶„μ„ν•μ—¬ κ²½κ³  λ©”μ‹μ§€(π¨, β οΈ)**λ΅ λ³΄μ—¬μ¤λ‹λ‹¤.

## 2. κ΄€λ ¨ λ°μ΄ν„°λ² μ΄μ¤ ν…μ΄λΈ”

μ΄ λ΅μ§μ€ λ‹¤μ ν…μ΄λΈ”λ“¤μ λ°μ΄ν„°λ¥Ό μΆ…ν•©ν•μ—¬ νλ‹¨ν•©λ‹λ‹¤:

1.  **`products`**: μ ν’ κΈ°λ³Έ μ •λ³΄ (μ ν’λ…, λ³΄κ³ λ²νΈ λ“±)
2.  **`product_allergens`**: μ ν’λ³„ ν¬ν•¨λ μ•λ¬μ§€ μ λ° λ¬Όμ§ ID (μ: μ°μ , λ•…μ½© λ“±)
3.  **`product_sweeteners`**: μ ν’λ³„ ν¬ν•¨λ κ°λ―Έλ£ ID (μ: μν¬λ„λ΅μ¤, μ•„μ¤ννƒ λ“±)
4.  **`user_allergens`**: μ μ €κ°€ λ“±λ΅ν• κΈ°ν”Ό μ•λ¬μ§€ λ©λ΅
5.  **`user_diseases`**: μ μ €κ°€ λ“±λ΅ν• μ§€λ³‘ λ©λ΅ (μ: λ‹Ήλ‡¨, κ³ νμ••)
6.  **`sweetener_disease_rules`**: νΉμ • κ°λ―Έλ£κ°€ νΉμ • μ§€λ³‘μ— λ―ΈμΉλ” μν–¥ λ° μ£Όμμ‚¬ν•­ κ·μΉ™

---

## 3. κ²€μ‚¬ μ•κ³ λ¦¬μ¦ (Step-by-Step)

μ„λ²„λ” λ‹¤μκ³Ό κ°™μ€ μμ„λ΅ κ²€μ‚¬λ¥Ό μν–‰ν•©λ‹λ‹¤:

### 1λ‹¨κ³„: μ ν’ κ²€μƒ‰

μ‚¬μ©μκ°€ μ…λ ¥ν• κ²€μƒ‰μ–΄(`query`)λ¥Ό ν¬ν•¨ν•λ” μ ν’λ“¤μ„ `products` ν…μ΄λΈ”μ—μ„ μ΅°νν•©λ‹λ‹¤.

### 2λ‹¨κ³„: μ μ € ν”„λ΅ν•„ μ΅°ν

κ²€μƒ‰ μ”μ²­μ„ λ³΄λ‚Έ μ μ €(`userId`)μ **μ•λ¬μ§€ λ©λ΅**κ³Ό **μ§€λ³‘ λ©λ΅**μ„ DBμ—μ„ κ°€μ Έμµλ‹λ‹¤.

- (λ΅κ·ΈμΈν•μ§€ μ•μ€ κ²½μ° μ΄ λ‹¨κ³„λ” μƒλµλλ©° κ²½κ³ λ„ ν‘μ‹λμ§€ μ•μµλ‹λ‹¤.)

### 3λ‹¨κ³„: κµμ°¨ κ²€μ¦ (Cross-Check)

κ²€μƒ‰λ κ° μ ν’μ— λ€ν•΄ λ‹¤μ λ‘ κ°€μ§€ κ²€μ‚¬λ¥Ό μν–‰ν•©λ‹λ‹¤.

#### A. μ•λ¬μ§€ μ¶©λ κ²€μ‚¬ (Allergy Check)

1.  ν•΄λ‹Ή μ ν’μ λ³΄κ³ λ²νΈ(`report_no`)λ¥Ό μ΄μ©ν•΄ `product_allergens` ν…μ΄λΈ”μ—μ„ μ ν’μ— ν¬ν•¨λ λ¨λ“  μ•λ¬μ§€ μ„±λ¶„μ„ μ΅°νν•©λ‹λ‹¤.
2.  **μ ν’μ μ•λ¬μ§€ μ„±λ¶„**κ³Ό **μ μ €μ μ•λ¬μ§€ λ©λ΅**μ— **κ³µν†µλ ν•­λ©**μ΄ μλ”μ§€ λΉ„κµν•©λ‹λ‹¤.
3.  μΌμΉν•λ” ν•­λ©μ΄ μλ‹¤λ©΄, `π¨ μ•λ¬μ§€ μ£Όμ: [μ„±λ¶„λ…] ν•¨μ ` κ²½κ³ λ¥Ό μƒμ„±ν•©λ‹λ‹¤.

#### B. κ°λ―Έλ£ λ° μ§€λ³‘ κ²€μ‚¬ (Disease/Sweetener Check)

1.  ν•΄λ‹Ή μ ν’μ— ν¬ν•¨λ κ°λ―Έλ£λ¥Ό `product_sweeteners` ν…μ΄λΈ”μ—μ„ μ΅°νν•©λ‹λ‹¤.
2.  κ° κ°λ―Έλ£μ— λ€ν•΄ `sweetener_disease_rules` ν…μ΄λΈ”μ„ μ΅°νν•μ—¬, ν•΄λ‹Ή κ°λ―Έλ£κ°€ νΉμ • μ§€λ³‘μ— μ–΄λ–¤ μ£Όμμ‚¬ν•­μ΄ μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
3.  **κ°λ―Έλ£μ μ£Όμ μ§€λ³‘**μ΄ **μ μ €μ μ§€λ³‘ λ©λ΅**μ— ν¬ν•¨λμ–΄ μλ‹¤λ©΄, `β οΈ μ§€λ³‘ μ£Όμ ([κ°λ―Έλ£λ…]): [μ£Όμμ‚¬ν•­ λ©”μ‹μ§€]` κ²½κ³ λ¥Ό μƒμ„±ν•©λ‹λ‹¤.

---

## 4. κ²°κ³Ό λ°ν™

μ„ κ³Όμ •μ„ κ±°μ³ μƒμ„±λ κ²½κ³  λ©”μ‹μ§€λ“¤μ€ μ ν’ μ •λ³΄(`warnings` λ°°μ—΄)μ— λ‹΄κ²¨ ν”„λ΅ νΈμ—”λ“λ΅ μ „λ‹¬λλ©°, μ‚¬μ©μλ” κ²€μƒ‰ κ²°κ³Ό ν™”λ©΄μ—μ„ λΉ¨κ°„μƒ‰ λλ” λ…Έλ€μƒ‰ κ²½κ³  λ°°μ§€λ¥Ό ν†µν•΄ μ„ν— μ”μ†λ¥Ό μ¦‰μ‹ ν™•μΈν•  μ μμµλ‹λ‹¤.

---

## 5. κµ¬ν„ κ°€μ΄λ“ (Implementation Guide)

μ΄ κΈ°λ¥μ„ ν”„λ΅μ νΈμ— μ μ©ν•κΈ° μ„ν•΄ ν•„μ”ν• νμΌ μμ • λ‚΄μ—­μ…λ‹λ‹¤.

### 1. λ°±μ—”λ“ (Backend)

**μμ • νμΌ**: `backend/server.js`

- **λ³€κ²½ λ‚΄μ©**: κΈ°μ΅΄μ— μ—†λ `/api/search` μ—”λ“ν¬μΈνΈλ¥Ό μ¶”κ°€ν•΄μ•Ό ν•©λ‹λ‹¤.
- **κµ¬ν„ λ°©λ²•**:
  1.  `GET /api/search` μ”μ²­μ„ λ°›μΌλ©΄ `query`(κ²€μƒ‰μ–΄)μ™€ `userId`λ¥Ό νλΌλ―Έν„°λ΅ λ°›μµλ‹λ‹¤.
  2.  `products` ν…μ΄λΈ” κ²€μƒ‰ κ²°κ³Όμ™€ μ μ €μ μ•λ¬μ§€/μ§€λ³‘ μ •λ³΄λ¥Ό λ€μ΅°ν•λ” λ΅μ§(μ„μ μ•κ³ λ¦¬μ¦)μ„ μ‘μ„±ν•©λ‹λ‹¤.
  3.  κ° μ ν’ κ°μ²΄μ— `warnings` λ°°μ—΄μ„ μ¶”κ°€ν•μ—¬ μ‘λ‹µμΌλ΅ λ‚΄λ ¤μ¤λ‹λ‹¤.

### 2. ν”„λ΅ νΈμ—”λ“ (Frontend)

**μμ • νμΌ 1**: `frontend/src/App.jsx`

- **λ³€κ²½ λ‚΄μ©**: `SearchDetail` μ»΄ν¬λ„νΈμ— ν„μ¬ λ΅κ·ΈμΈν• μ μ € μ •λ³΄(`userInfo`)λ¥Ό μ „λ‹¬ν•΄μ•Ό ν•©λ‹λ‹¤.
- **μ½”λ“ λ³€κ²½**:

  ```jsx
  // λ³€κ²½ μ „
  <Route path="/search" element={<SearchDetail isLoggedIn={isLoggedIn} />} />

  // λ³€κ²½ ν›„
  <Route path="/search" element={<SearchDetail isLoggedIn={isLoggedIn} userInfo={userInfo} />} />
  ```

**μμ • νμΌ 2**: `frontend/src/components/SearchDetail.jsx`

- **λ³€κ²½ λ‚΄μ©**: μ§μ ‘ DB μΏΌλ¦¬λ¥Ό λ‚ λ¦¬λ(`db.execute`) λ°©μ‹μ„ λ°±μ—”λ“ API νΈμ¶(`fetch`)λ΅ λ³€κ²½ν•κ³ , κ²½κ³ μ°½μ„ λ„μ›μ•Ό ν•©λ‹λ‹¤.
- **κµ¬ν„ λ°©λ²•**:
  1.  `filterResults` ν•¨μμ—μ„ `http://localhost:3000/api/search` μ£Όμ†λ΅ `fetch` μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤.
  2.  λ°›μ•„μ¨ λ°μ΄ν„°μ `warnings` λ°°μ—΄μ„ ν™•μΈν•©λ‹λ‹¤.
  3.  ν™”λ©΄ λ λ”λ§ λ¶€λ¶„(`results.map`)μ— `item.warnings`κ°€ μμΌλ©΄ λΉ¨κ°„μƒ‰ κ²½κ³  λ°°μ§€λ¥Ό μ¶λ ¥ν•λ” UI μ½”λ“λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.
